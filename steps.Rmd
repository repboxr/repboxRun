Based on the code in `repboxRun.R` (specifically the `repbox_run_project` function), here is the breakdown of the currently implemented analysis steps.

The pipeline is controlled by the `steps` list (generated via `repbox_steps_from()`) and executed sequentially.

### 1. `file_info` (Supplement & Article Metadata)

-   **Goal:** distinct basic metadata about files and the article.

-   **Actions:**

    -   Calls `sup_save_basic_info`: Scans the `org` directory (original supplement) to tally file types, sizes, and timestamps.
    -   Calls `repboxArt::art_save_basic_info`: Extracts basic metadata (Title, Authors, Year) from the article PDF.

-   **Storage:** Saves `sup`, `file_info`, and `file_type_info` parcels to `repdb`.

### 2. `static_code` (Static Analysis)

-   **Goal:** Analyze code files without running them.

-   **Actions:**

    -   **Stata:** Calls `repbox_stata_static_parcel` and `repboxCodeText::code_project_find_refs`. It parses do-files to identify input/output files and looks for comments referencing tables (e.g., `// Table 1`).
    -   **R:** Calls `repboxR::repbox_project_static_analyse_r` to parse libraries used and script structure.

-   **Storage:** Saves script text and source references to `repdb`.

### 3. `art` (Article Parsing - Legacy)

-   **Goal:** Convert the article PDF/HTML into structured text and extract tables.

-   **Actions:**

    -   Calls `repboxArt::art_update_project`.
    -   **Note:** This is the "Legacy" parsing step you are planning to replace with `repboxDoc`. It uses heuristics to find section headers and matrix-like text blocks that look like tables.

### 4. `reproduction` (Execution)

-   **Goal:** Run the code to verify reproducibility.

-   **Actions:**

    -   **Prep:** Clears the `mod` (modified) directory, copies `org` to `mod`, and unzips any nested ZIPs found.
    -   **Slimify:** If `opts$slimify_org` is TRUE, it deletes non-code files from the `org` folder to save space.
    -   **Stata Execution:** Calls `repbox_project_run_stata`. This runs the Master do-file (or all do-files), handles timeouts, and parsing logs to detect errors (missing data, syntax errors).
    -   **R Execution:** Calls `repbox_project_run_r` to execute R scripts.

-   **Storage:** Saves run logs (`stata_run_info`) and results to `repdb`.

### 5. `reg` (Regression Extraction)

-   **Goal:** Extract specific regression coefficients and scalars for meta-analysis.

-   **Condition:** Only runs if Stata was used and previous runs were successful (`has_ok_stata_regs`).

-   **Actions:**

    -   **Re-run:** It actually **runs the Stata code a second time** (or distinct parts of it) with `extract.reg.info = TRUE`.
    -   **Interception:** Uses `repboxReg` (via `repboxStata`) to intercept regression commands and store the coefficients, standard errors, $N$, and $R^2$.
    -   **DAP:** Updates the "Display Analysis Parcel" (`dap`) which organizes these results.

-   **Storage:** Saves `stata_reg` and `stata_scalar` parcels.

### 6. `mr_base` (Meta-Regression Calculation)

-   **Goal:** Compute standardized statistics.

-   **Actions:**

    -   Calls `mr_base_run_study`.
    -   Likely calculates t-stats, standardized effect sizes, or other metrics required for the wider meta-analysis project, based on the raw data extracted in step 5.

### 7. `repbox_repdb` (Database Sync)

-   **Goal:** Consolidate data.

-   **Actions:**

    -   Calls `repbox_to_repdb`.
    -   Ensures all local parcels are formatted correctly to be pushed to the central repbox database.

### 8. `map` (Result Mapping - Legacy)

-   **Goal:** Link code results to article tables.

-   **Actions:**

    -   Calls `repboxMap::map_repbox_project`.
    -   Matches the regression results found in **Step 5** (`reg`) with the tables found in **Step 3** (`art`).
    -   *Note:* This is the step that uses fuzzy matching or heuristics to say "Regression 1 in `main.do` corresponds to Table 2 Column 1 in the PDF".

### 9. `html` (Reporting)

-   **Goal:** Visualize findings.

-   **Actions:**

    -   Calls `repboxHtml::repbox_project_html`.
    -   Generates the static HTML report summarizing errors, run times, and the mapping between code and paper.

------------------------------------------------------------------------

### Key Observations for your Refactoring:

-   The pipeline implies a **"Double Run" strategy** for Stata: once for pure reproduction (`reproduction` step) and once for instrumentation/extraction (`reg` step).
-   **Step 3 (`art`)** and **Step 8 (`map`)** are the primary dependencies on the legacy `repboxArt` and `repboxMap` packages.
-   **Step 2 (`static_code`)** is currently handled by `repboxCodeText`, which seems distinct from the AI/LLM approaches you are exploring in `repboxAI`.
